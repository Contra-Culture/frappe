<DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>frappe.js</title>
    <sctipt type="module" src="o.mjs"></sctipt>
    <script type="module">
      import {Universe, VM} from "./o.mjs"
      const u = new Universe(
        (stream)=> {
          stream("orderReceived", () => {})
          stream("orderConfirmed", () => {})
          stream("orderRejected", () => {})
          stream("orderPackaged", () => {})
          stream("orderDelivered", () => {})
          stream("orderLost", () => {})
        },
        (object) => {
          object( "orderConfirmator",
                  (props) => { },
                  (prop) => {
                    prop()
                    prop()
                    prop()
                  },
                  (reaction) => {
                    reaction("orderReceived", (msg) => { }, ["orderConfirmed", "orderRejected"])
                  } )
          object( "orderPackager",
                  (props) => { },
                  (prop) => {
                    prop("n", () => {  }, () => {  })
                    prop()
                    prop()
                  },
                  (reaction) => {
                    reaction("orderConfirmed", (msg) => { }, ["orderPackaged"])
                  } )
          object( "orderDeliverer",
                  (props) => {},
                  (prop) => {
                    prop()
                    prop()
                    prop()
                  },
                  (reaction) => {
                    reaction("orderPackaged", (msg) => { }, ["orderDelivered", "orderLost"])
                  } )
        }
      )
      u.inspect()
    </script>
    <script type="module" src="app.mjs"></script>
    <script type="module">
      import {App} from "./app.mjs"

      window.app = new App( "myApp",
                            window,
                            document.querySelector("#app"),
                            // widgets
                            { "widgetA": { prepare: () => { },
                                           render:  () => { },
                                           exit:    () => { },
                                         },
                              "widgetB": { prepare: () => { },
                                           render:  () => { },
                                           exit:    () => { },
                                         },
                              "widgetC": { prepare: () => { },
                                           render:  () => { },
                                           exit:    () => { },
                                         },
                            },
                            // layouts
                            { "main": { widgets: ["widgetA", "widgetB", "widgetC"],
                                        prepare: () => { },
                                        render:  () => { },
                                        exit:    () => { },
                                      },
                            },
                            // screens
                            { "dashboard": { layout: "main",
                                             widgets: ["widgetA", "widgetB", "widgetC"],
                                             prepare: () => { },
                                             render:  () => { },
                                             exit:    () => { },
                                           },
                              "articles": { layout: "main",
                                            widgets: ["widgetA", "widgetB", "widgetC"],
                                            prepare: () => { },
                                            render:  () => { },
                                            exit:    () => { },
                                          },
                              "article": { layout: "main",
                                           widgets: ["widgetA", "widgetB", "widgetC"],
                                           prepare: () => { },
                                           render:  () => { },
                                           exit:    () => { },
                                         },
                            },
                            { data: { screen: "root",
                                      someVal: true,
                                    },
                              children: { "articles": { as: "articles",
                                                        data: { screen: "articles",
                                                                anotherVal: false,
                                                              },
                                                        children: { ":articleID": { as: "article",
                                                                                    data: { screen: "article",
                                                                                          },
                                                                                    matches: (chunk) => { return true }
                                                                                  }
                                                                  }
                                                      }
                                        }
                            }
                          )
      console.log("app: ", app)
    </script>
  </head>
  <body>
    <button onclick="app.URLHelpers.root()">Root</button>
    <button onclick="app.URLHelpers.articles()">Articles</button>
    <button onclick="app.URLHelpers.article({articleID: 'My Article'})">Article: "My Article"</button>

    <div id="app">

    </div>
  </body>
</html>
